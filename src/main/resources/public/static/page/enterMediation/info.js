define("page/enterMediation/info",["require","exports","module","components/jquery/jquery","page/header/base","components/layer/layer","static/libs/ajaxfileupload/ajaxfileupload"],function(e,t,n){var a=e("components/jquery/jquery"),i=e("page/header/base"),p=e("components/layer/layer");e("static/libs/ajaxfileupload/ajaxfileupload");var d=function(){var e=this;e.init(),e.submit(),e.add(),e.del(),e.agent(),e.evidence()};d.prototype.init=function(){l(0),l(1);var e=new Date;a(document).on("click","._applicantBirthday",function(){t()}),a(document).on("click","._respondentBirthday",function(){t()});var t=function(){WdatePicker({maxDate:e.toLocaleDateString(),lang:"zh-cn",dateFmt:"yyyy-MM-dd"})}},d.prototype.submit=function(){a(document).on("click","#_submit",function(){if(o.dispute()&&o.applicant()&&o.respondent()&&o.notice()){var e=s();a.ajax({url:"/common/temp",type:"POST",dataType:"text",data:{content:e}}).done(function(e){a("#_fileName").val(e),a("#_hDisputeType").val(a("#_disputeType").val()),a("#orderForm").submit()}).fail(function(e,t,n){console.log(e,t,n),alert("系统繁忙, 请稍后再试")})}})},d.prototype.add=function(){var e="";a.ajax({url:"/findNation",type:"get"}).done(function(t){1==t.code&&(a.each(t.data,function(t,n){e+='<option value="'+n.code+'">'+n.codeName+"</option>"}),a("._applicantNation,._respondentNation").append(e))}),a(document).on("change","._applicantType",function(){var e=a(this).val();p("_applicant",e,a(this))}),a(document).on("change","._respondentType",function(){var e=a(this).val();p("_respondent",e,a(this))}),a(document).on("click","._applicantAdd",function(){var e=a(this),n=parseInt(e.data("num"))+1;e.data("num",n),t("_applicant","申请人",n)}),a(document).on("click","._respondentAdd",function(){var e=a(this),n=parseInt(e.data("num"))+1;e.data("num",n),t("_respondent","被申请人",n)}),a(document).on("change","._applicantIdType",function(){var e=a(this),t=e.parent().siblings(".type-idc");t.find("input").val(""),"ZJ-08"==e.val()?t.show():t.hide()}),a(document).on("change","._respondentIdType",function(){var e=a(this),t=e.parent().siblings(".type-idc");t.find("input").val(""),"ZJ-08"==e.val()?t.show():t.hide()});var t=function(e,t,i){var p="",d=n(e);p+='<div class="'+e+'"><div class="apply-person">'+t+"<em>"+i+'</em><a class="delete-apply fr" href="javascript:;"><i></i>删除</a></div><div class="type-dispute"><span class="name"><em>*</em>当事人类型：</span><select class="select300 '+e+'Type"><option value="1">自然人</option><option value="2">法人</option><option "value="3">其他组织</option></select></div>'+d+"</div>",a("#"+e+"-box").append(p),l("_applicant"==e?0:1)},n=function(t){var n="",a="";"_applicant"==t&&(n+='<div class="type-dispute dis-block"><span class="name">委托代理人：</span><a class="add-agent" href="javascript:;">添加委托代理人</a><input type="hidden" class="_deputeName" value=""><input type="hidden" class="_deputeTel" value=""><input type="hidden" class="_deputeRelation" value=""></div>',a+="<em>*</em>");var i='<div class="type-dispute"><span class="name"><em>*</em>姓名：</span><input class="input300 '+t+'Name" maxlength="50" type="text" name="" placeholder="请输入姓名"></div><div class="type-dispute"><span class="name"><em>*</em>性别：</span><select class="select300 '+t+'Sex"><option value="00003-1">男性</option><option value="00003-2">女性</option><option value="00003-255">其他</option></select></div><div class="type-dispute"><span class="name">出生日期：</span><input class="input300 calendar '+t+'Birthday" type="text" name="" placeholder="请输入出生日期"></div><div class="type-dispute"><span class="name"><em>*</em>民族：</span><select class="select300 _'+t+'Nation">'+e+'</select></div><div class="type-dispute"><span class="name"><em>*</em>手机号码：</span><input class="input300 '+t+'Tel" maxlength="11" type="text" name="" placeholder="请输入手机号码"></div><div class="type-dispute dis-block"><span class="name">'+a+'证件类型：</span><select class="select300 '+t+'IdType"><option value="ZJ-01">居民身份证</option><option value="ZJ-02">中国公民护照</option><option value="ZJ-03">台湾居民来往大陆通行证</option><option value="ZJ-04">港澳居民来往内地通行证</option><option value="ZJ-05">外国公民护照</option><option value="ZJ-06">户口薄</option><option value="ZJ-07">社会统一信用代码证</option><option value="ZJ-08">其他</option></select></div><div class="type-dispute dis-block type-idc"><span class="name">'+a+'证件名称：</span><input class="input300 '+t+'IdName" maxlength="50" type="text" name="" placeholder="请输入证件名称"></div><div class="type-dispute dis-block"><span class="name">'+a+'证件号码：</span><input class="input300 '+t+'Id" maxlength="30" type="text" name="" placeholder="请输入证件号码"></div><div class="type-dispute dis-block"><span class="name">居住地址：</span><input class="input300 '+t+'Address" maxlength="200" type="text" name="" style="width: 750px;" placeholder="请输入居住地址"></div>'+n;return i},i=function(e,t){var n="",a="";"_applicant"==e&&(n+='<div class="type-dispute dis-block"><span class="name">委托代理人：</span><a class="add-agent" href="javascript:;">添加委托代理人</a><input type="hidden" class="_deputeName" value=""><input type="hidden" class="_deputeTel" value=""><input type="hidden" class="_deputeRelation" value=""></div>'),a+=2==t?"法定代表人":"组织负责人";var i='<div class="type-dispute"><span class="name"><em>*</em>名称：</span><input class="input300 '+e+'UnitName" maxlength="50" type="text" name="" placeholder="请输入名称"></div><div class="type-dispute dis-block"><span class="name">所在地：</span><input class="input300 '+e+'UnitAddress" maxlength="200" type="text" name="" style="width: 750px;" placeholder="请输入所在地"></div><div class="type-dispute"><span class="name"><em>*</em>手机号码：</span><input class="input300 '+e+'UnitTel" maxlength="11" type="text" name="" placeholder="请输入手机号码"></div><div class="type-dispute dis-block"><span class="name"><em>*</em>'+a+'：</span><input class="input300 '+e+'UnitLeagl" maxlength="200"  type="text" name="" style="width: 750px;" placeholder="请输入'+a+'"></div>'+n;return i},p=function(e,t,a){var p="";a.parents(".type-dispute").siblings(".type-dispute").remove();var d=n(e),l=i(e,t);p+=1==t?d:l,a.parents(".type-dispute").parent().append(p)}},d.prototype.del=function(){a(document).on("click","._applicant .delete-apply",function(){var e=a(this);e.parents("._applicant").remove(),l(0);var t=a("._applicant").length;a("._applicantAdd").data("num",t)}),a(document).on("click","._respondent .delete-apply",function(){var e=a(this);e.parents("._respondent").remove(),l(1);var t=a("._respondent").length;a("._respondentAdd").data("num",t)})},d.prototype.agent=function(){var e=function(t){a.ajax({url:"/agentRelation",type:"get",data:{parentId:t}}).done(function(n){if(1==n.code){var i="";a.each(n.data,function(e,t){i+='<option value="'+t.id+'">'+t.name+"</option>"}),0==t?(a("#_parentSel").empty(),a("#_parentSel").append(i),e(n.data[0].id)):(a("#_childSel").empty(),a("#_childSel").append(i))}})};e(0),a(document).on("change","#_parentSel",function(){var t=a(this);e(t.val())}),a(document).on("click",".add-agent",function(){var t=a(this),n=t.parents("._applicant").index();a(".depute").data("num",n);var i=t.siblings("._deputeName").val(),p=t.siblings("._deputeTel").val(),d=t.siblings("._deputeRelation").val();if(""==i)a("#_deputeName").val(""),a("#_deputeTel").val(""),e(0);else{var l=t.siblings("._partentCode").val();a("#_deputeName").val(i),a("#_deputeTel").val(p),e(l),setTimeout(function(){a("#_parentSel option").each(function(){a(this).attr("value")==l&&a(this).prop("selected",!0)}),a("#_childSel option").each(function(){a(this).attr("value")==d&&a(this).prop("selected",!0)})},200)}a(".depute").show(),a(".pop-mask").show()}),a(document).on("click","#submitAgent",function(){var e=(a(this),a(".depute").data("num")),t=a("#_deputeName").val(),n=a("#_deputeTel").val(),i=a("#_childSel").val(),d=a("#_parentSel").val(),l=new RegExp(/^1\d{10}$/);if(""==t)return p.alert("委托代理人姓名不能为空"),!1;if(""==n)return p.alert("委托代理人手机号不能为空"),!1;if(!l.test(n))return p.alert("委托代理人手机号格式不正确"),!1;var s=a("._applicant:eq("+e+")");s.find("._deputeName").val(t),s.find("._deputeTel").val(n),s.find("._deputeRelation").val(i),s.find(".add-agent").parents(".type-dispute").find(".type-person").remove(),s.find(".add-agent").parents(".type-dispute").find("._partentCode").remove(),s.find(".add-agent").parents(".type-dispute").find(".type-editor").remove(),s.find(".add-agent").parents(".type-dispute").find(".type-delete").remove(),s.find(".add-agent").hide();var o="";o+='<input type="hidden" class="_partentCode" value="'+d+'"><span class="type-person">'+t+'</span><a class="add-agent type-editor" href="javascript:;"><i></i>编辑</a><a class="type-delete" href="javascript:;"><i></i>删除</a>',s.find(".add-agent").parents(".type-dispute").append(o),a(".depute").hide(),a(".pop-mask").hide()}),a(document).on("click",".type-delete",function(){var e=a(this);e.parents(".type-dispute").find(".add-agent").show(),e.siblings(".type-editor").remove(),e.siblings("._partentCode").remove(),e.siblings(".type-person").remove(),e.siblings("._deputeName").val(""),e.siblings("._deputeTel").val(""),e.siblings("._deputeRelation").val(""),e.remove()}),a(document).on("click","#cancelAgent",function(){a(this);a(".depute").hide(),a(".pop-mask").hide()}),a(document).on("click","#eviCloseBtn",function(){a(this);a(".depute").hide(),a(".pop-mask").hide()}),a(document).on("click","#e-book",function(){a("#word-text-one").show(),a(".pop-mask").show()}),a(document).on("click","#e-book-close",function(){a("#word-text-one").hide(),a(".pop-mask").hide()}),a(document).on("click","#e-book-two",function(){a("#word-text-two").show(),a(".pop-mask").show()}),a(document).on("click","#e-sure-close",function(){a("#word-text-two").hide(),a(".pop-mask").hide()})},d.prototype.evidence=function(){a(document).on("change","#newEditPUpload",function(){return/(\.|\/)(jpg|png|jpeg|bmp|doc|docx)$/i.test(a("#newEditPUpload").val())?void a.ajaxFileUpload({url:"/upload",secureuri:!1,fileElementId:"newEditPUpload",dataType:"json",type:"post",data:{folder:"1"},success:function(e){if(1==e.code){var t=e.data.split(","),n=t[0],i=t[1];a("#_evidenceBox").append('<span data-url="'+n+'">'+i+'<a href="javascript:;"></a></span>')}else p.alert("上传文件出错")},error:function(){p.alert("error")}}):(p.alert("仅支持JPG,PNG,JPEG,BMP,DOC,DOCX格式"),!1)}),a(document).on("click","#_evidenceBox span a",function(){var e=a(this);e.parent("span").remove()})};var l=function(e){0==e?a("._applicant").each(function(e){var t=e+1;a(this).find(".apply-person em").text(i.intToChinese(t))}):a("._respondent").each(function(e){var t=e+1;a(this).find(".apply-person em").text(i.intToChinese(t))})},s=function(){var e={};e.disputeType=a("#_disputeType").val(),e.dispute=a("#_dispute").val(),e.applyMatter=a("#_applyMatter").val(),e.applicantPartyList=new Array,e.respondentPartyList=new Array,e.evidences=new Array;var t=a("#_applicant-box ._applicant"),n=null,i=null;t.each(function(){var t=a(this),p=t.find("._applicantType").val();1==p?(n={},n.type=t.find("._applicantType").val(),n.name=t.find("._applicantName").val(),n.sex=t.find("._applicantSex").val(),n.birthday=t.find("._applicantBirthday").val(),n.nation=t.find("._applicantNation").val(),n.tel=t.find("._applicantTel").val(),n.idType=t.find("._applicantIdType").val(),n.idc=t.find("._applicantId").val(),n.idName=t.find("._applicantIdName").val(),n.address=t.find("._applicantAddress").val(),n.depute={deputeName:t.find("._deputeName").val(),deputeTel:t.find("._deputeTel").val(),deputeRelation:t.find("._deputeRelation").val()},e.applicantPartyList.push(n)):(i={},i.type=t.find("._applicantType").val(),i.unitName=t.find("._applicantUnitName").val(),i.unitAddress=t.find("._applicantUnitAddress").val(),i.unitTel=t.find("._applicantUnitTel").val(),i.unitLeagl=t.find("._applicantUnitLeagl").val(),i.unitDepute={deputeName:t.find("._deputeName").val(),deputeTel:t.find("._deputeTel").val(),deputeRelation:t.find("._deputeRelation").val()},e.applicantPartyList.push(i))});var p=a("#_respondent-box ._respondent"),d=null,l=null;p.each(function(){var t=a(this),n=t.find("._respondentType").val();1==n?(d={},d.type=t.find("._respondentType").val(),d.name=t.find("._respondentName").val(),d.sex=t.find("._respondentSex").val(),d.birthday=t.find("._respondentBirthday").val(),d.nation=t.find("._respondentNation").val(),d.tel=t.find("._respondentTel").val(),d.idType=t.find("._respondentIdType").val(),d.idc=t.find("._respondentId").val(),d.idName=t.find("._respondentIdName").val(),d.address=t.find("._respondentAddress").val(),e.respondentPartyList.push(d)):(l={},l.type=t.find("._respondentType").val(),l.unitName=t.find("._respondentUnitName").val(),l.unitAddress=t.find("._respondentUnitAddress").val(),l.unitTel=t.find("._respondentUnitTel").val(),l.unitLeagl=t.find("._respondentUnitLeagl").val(),e.respondentPartyList.push(l))});var s=null;return a("#_evidenceBox span").each(function(){s={},s.name=a(this).text(),s.url=a(this).data("url"),e.evidences.push(s)}),JSON.stringify(e)},o={dispute:function(){return""==a("#_disputeType").val()?(p.alert("纠纷类型不能为空"),!1):""==a.trim(a("#_dispute").val())?(p.alert("纠纷概况不能为空"),!1):a("#_dispute").val().length>500?(p.alert("纠纷概况字数不能超过500"),!1):""==a.trim(a("#_applyMatter").val())?(p.alert("申请事项不能为空"),!1):a("#_applyMatter").val().length>500?(p.alert("申请事项字数不能超过500"),!1):!0},applicant:function(){var e=a("#_applicant-box ._applicant"),t=!1;return e.each(function(){var e=a(this),n=new RegExp(/^1\d{10}$/),i=/(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|[A-Za-z])$)/,d="申请人"+e.find(".apply-person em").text(),l=e.find("._applicantType").val(),s=a.trim(e.find("._applicantName").val()),o=a.trim(e.find("._applicantTel").val()),r=a.trim(e.find("._applicantId").val()),c=a.trim(e.find("._applicantIdType").val()),u=a.trim(e.find("._applicantIdName").val()),v=a.trim(e.find("._applicantUnitName").val()),m=a.trim(e.find("._applicantUnitTel").val()),f=a.trim(e.find("._applicantUnitLeagl").val()),_="";if(_=2==l?"法定代表人":"组织负责人",1==l){if(""==s)return p.alert(d+"姓名不能为空"),t=!1,!1;if(""==o)return p.alert(d+"手机号不能为空"),t=!1,!1;if(!n.test(o))return p.alert(d+"手机号格式不正确"),t=!1,!1;if("block"==e.find("._applicantIdName").parent().css("display")&&""==u)return p.alert(d+"证件名称不能为空"),t=!1,!1;if(""==r)return p.alert(d+"证件号码不能为空"),t=!1,!1;if("ZJ-01"==c&&!i.test(r))return p.alert(d+"证件号码格式不正确"),t=!1,!1}else{if(""==v)return p.alert(d+"名称不能为空"),t=!1,!1;if(""==m)return p.alert(d+"手机号不能为空"),t=!1,!1;if(!n.test(m))return p.alert(d+"手机号格式不正确"),t=!1,!1;if(""==f)return p.alert(d+_+"不能为空"),t=!1,!1}t=!0}),t},respondent:function(){var e=a("#_respondent-box ._respondent"),t=!1;return e.each(function(){var e=a(this),n=new RegExp(/^1\d{10}$/),i=/(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|[A-Za-z])$)/,d="被申请人"+e.find(".apply-person em").text(),l=e.find("._respondentType").val(),s=a.trim(e.find("._respondentName").val()),o=a.trim(e.find("._respondentTel").val()),r=a.trim(e.find("._respondentId").val()),c=a.trim(e.find("._respondentIdType").val()),u=(a.trim(e.find("._respondentIdName").val()),a.trim(e.find("._respondentUnitName").val())),v=a.trim(e.find("._respondentUnitTel").val()),m=a.trim(e.find("._respondentUnitLeagl").val()),f="";if(f=2==l?"法定代表人":"组织负责人",1==l){if(""==s)return p.alert(d+"姓名不能为空"),t=!1,!1;if(""==o)return p.alert(d+"手机号不能为空"),t=!1,!1;if(!n.test(o))return p.alert(d+"手机号格式不正确"),t=!1,!1;if(""!=r&&"ZJ-01"==c&&!i.test(r))return p.alert(d+"证件号码格式不正确"),t=!1,!1}else{if(""==u)return p.alert(d+"名称不能为空"),t=!1,!1;if(""==v)return p.alert(d+"手机号不能为空"),t=!1,!1;if(!n.test(v))return p.alert(d+"手机号格式不正确"),t=!1,!1;if(""==m)return p.alert(d+f+"不能为空"),t=!1,!1}t=!0}),t},evidence:function(){},notice:function(){return a("#_notice1").prop("checked")&&a("#_notice2").prop("checked")?!0:(p.alert("请勾选告知事项"),!1)}};n.exports=d});